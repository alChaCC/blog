
<!DOCTYPE HTML>
<html>
<head>
	<script data-cfasync="false" type="text/javascript" src="//use.typekit.net/axj3cfp.js"></script>
	<script data-cfasync="false" type="text/javascript">try{Typekit.load();}catch(e){}</script>
	<meta charset="utf-8">
	<title>我的RoR學習專案-Day 1  | AlohaCC</title>

<meta name="author" content="Aloha"> 

<meta name="description" content="Share Ruby on Rail and all about 'Chun Yu, Chen AlohaCC'"> <meta name="keywords" content="Aloha, Ruby on Rails, 中文, Blog, Full Stack web developer, Taiwan, Chun-Yu Chen, data scientist">

	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="http://feeds.feedburner.com/Alohacc" rel="alternate" title="AlohaCC" type="application/atom+xml">
	<link rel="canonical" href="">
	<link href="/favicon.png" rel="shortcut icon">
	<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
	<!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
	<script type="text/javascript" src="/javascripts/jquery.fancybox.pack.js"></script>

<script language="Javascript" type="text/javascript">
$(document).ready(
  function() {
    (function($) {
      $(".fancybox[data-content-id]").each(function() {
        this.href = $(this).data('content-id');
      });
      $(".fancybox").fancybox({
        beforeLoad: function() {
          var el, 
              id = $(this.element).data('title-id');

          if (id) {
            el = $('#' + id);

            if (el.length) {
              this.title = el.html();
            }
          }
          if ($(this).data('content')) {
            this.content = $(this).data('content');
          }
        },
        helpers: {
          title: {
            type: 'inside'
          }
        }
      });
    })(jQuery);
  }
);
</script>

	
</head>



<body>
	<header id="header" class="inner"><h1><a href="/">AlohaCC</a></h1>
<h4>Stay Hungry. Stay Foolish.</h4>
<nav id="main-nav"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/About">About</a></li>
  <li><a href="/protfolio">Protfolio</a></li>
	<li><a href="/presentation">Presentation</a></li>
  <li><a href="/blog/categories/ruby-on-rails">Ruby on Rails</a></li>
  <li><a href="/blog/categories/google-analytics">Google Analytics</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</nav>
<nav id="mobile-nav">
	<div class="alignleft menu">
		<a class="button">Menu</a>
		<div class="container"><ul>
	<li><a href="/">Blog</a></li>
	<li><a href="/About">About</a></li>
  <li><a href="/protfolio">Protfolio</a></li>
	<li><a href="/presentation">Presentation</a></li>
  <li><a href="/blog/categories/ruby-on-rails">Ruby on Rails</a></li>
  <li><a href="/blog/categories/google-analytics">Google Analytics</a></li>
	<li><a href="/archives">Archive</a></li>
</ul>
</div>
	</div>
	<div class="alignright search">
		<a class="button"></a>
		<div class="container">
			<form action="http://google.com/search" method="get">
				<input type="text" name="q" results="0">
				<input type="hidden" name="q" value="site:ccaloha.cc">
			</form>
		</div>
	</div>
</nav>


</header>

	<div id="content" class="inner"><article class="post">
	<h2 class="title">我的RoR學習專案-Day 1</h2>
	<div class="entry-content"><p><em>建立可以連到各個頁面的首頁</em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">rails</span> <span class="n">g</span> <span class="n">controller</span> <span class="n">welcomes</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p><em>在config/routes.rb把＃號拿掉變成root :to => &#8220;welcomes#index&#8221;</em></p>

<!--more-->


<p></p>

<p><em>在controllers/welcomes_controller.rb加上</em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> 
</span><span class='line'>  <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p><em>移除public/index.html</em></p>

<p><em>在app/views/welcomes新建index.html.erb</em></p>

<p>*在config/route.rb，把＃拿掉並改成</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">resources</span> <span class="ss">:welcomes</span> <span class="o">*</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p><em>建立about me controller頁面</em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> 
</span><span class='line'>  <span class="n">rails</span> <span class="n">g</span> <span class="n">controller</span> <span class="n">aboutmes</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>在config/route.rb加上</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">resources</span> <span class="ss">:aboutmes</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>在app/view/welcomes/index.html.erb加上</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="o">&lt;%=</span> <span class="n">link_to</span> <span class="s2">&quot;About Me&quot;</span> <span class="p">,</span> <span class="n">aboutmes_path</span> <span class="o">%&gt;</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>在app/view/aboutmes新增index.html.erb</p>

<p><em>建立blog controller 頁面</em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">rails</span> <span class="n">g</span> <span class="n">controller</span> <span class="n">blogs</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p><em>在config/route.rb加上</em></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">resources</span> <span class="ss">:blogs</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p><strong>開始建立論壇專案</strong></p>

<p>建立model</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">rails</span> <span class="n">g</span> <span class="n">model</span> <span class="no">Forum</span>
</span><span class='line'>  <span class="n">rails</span> <span class="n">g</span> <span class="n">model</span> <span class="no">Post</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>智障的我 沒有加入欄位資訊&#8230;等，所以必須使用migrate這個功能去新增欄位，先加forums好了</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">rails</span> <span class="n">g</span> <span class="n">migration</span> <span class="n">add_basic_column_to_forums</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>修改db/migrate/20110831030156_add_basic_column_to_forums.rb，論壇的table要有哪些？論壇分類名稱,管理者,論壇簡介,文章數，注意～self.down是反向的</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>          <span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;forums&quot;</span> <span class="p">,</span> <span class="s2">&quot;forum_name&quot;</span>       <span class="p">,</span> <span class="ss">:string</span> <span class="p">,</span> <span class="p">{</span><span class="ss">:null</span><span class="o">=&gt;</span><span class="kp">false</span><span class="p">,</span> <span class="ss">:limit</span><span class="o">=&gt;</span><span class="mi">100</span><span class="p">}</span> <span class="p">)</span>
</span><span class='line'>          <span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;forums&quot;</span> <span class="p">,</span> <span class="s2">&quot;admin_forum_user&quot;</span> <span class="p">,</span> <span class="ss">:string</span> <span class="p">,</span> <span class="p">{</span><span class="ss">:limit</span> <span class="o">=&gt;</span> <span class="mi">25</span><span class="p">})</span>
</span><span class='line'>          <span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;forums&quot;</span> <span class="p">,</span> <span class="s2">&quot;description&quot;</span>      <span class="p">,</span> <span class="ss">:string</span> <span class="p">)</span>
</span><span class='line'>          <span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;forums&quot;</span> <span class="p">,</span> <span class="s2">&quot;post_num&quot;</span>         <span class="p">,</span> <span class="ss">:integer</span><span class="p">)</span>
</span><span class='line'>          <span class="n">add_index</span><span class="p">(</span><span class="s2">&quot;forums&quot;</span>  <span class="p">,</span> <span class="s2">&quot;forum_name&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>      <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
</span><span class='line'>          <span class="n">remove_index</span><span class="p">(</span><span class="s2">&quot;forums&quot;</span>  <span class="p">,</span> <span class="s2">&quot;forum_name&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;forums&quot;</span><span class="p">,</span><span class="s2">&quot;post_num&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;forums&quot;</span><span class="p">,</span><span class="s2">&quot;description&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;forums&quot;</span><span class="p">,</span><span class="s2">&quot;admin_forum_user&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;forums&quot;</span><span class="p">,</span><span class="s2">&quot;forum_name&quot;</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>別忘記，做完資料表更改都要做migrate*</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">rake</span> <span class="n">db</span><span class="ss">:migrate</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>那Post勒？</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>          <span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;posts&quot;</span> <span class="p">,</span> <span class="s2">&quot;post_title&quot;</span>       <span class="p">,</span> <span class="ss">:string</span> <span class="p">,</span> <span class="ss">:limit</span> <span class="o">=&gt;</span> <span class="mi">100</span> <span class="p">,</span> <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span> <span class="p">)</span>
</span><span class='line'>          <span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;posts&quot;</span> <span class="p">,</span> <span class="s2">&quot;poster_name&quot;</span>      <span class="p">,</span> <span class="ss">:string</span> <span class="p">,</span> <span class="ss">:limit</span> <span class="o">=&gt;</span> <span class="mi">25</span>  <span class="p">,</span> <span class="ss">:null</span> <span class="o">=&gt;</span> <span class="kp">false</span> <span class="p">)</span>
</span><span class='line'>          <span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;posts&quot;</span> <span class="p">,</span> <span class="s2">&quot;content&quot;</span>          <span class="p">,</span> <span class="ss">:text</span> <span class="p">)</span>
</span><span class='line'>      <span class="o">=&gt;</span><span class="err">這邊是因為內容我不希望是有字數限制的所以我的</span><span class="n">type</span><span class="err">選擇</span><span class="n">text</span>
</span><span class='line'>          <span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;posts&quot;</span> <span class="p">,</span> <span class="s2">&quot;position&quot;</span>         <span class="p">,</span> <span class="ss">:integer</span><span class="p">)</span>
</span><span class='line'>          <span class="n">add_colume</span><span class="p">(</span><span class="s2">&quot;posts&quot;</span> <span class="p">,</span> <span class="s2">&quot;is_public&quot;</span>        <span class="p">,</span> <span class="ss">:boolean</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
</span><span class='line'>          <span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;posts&quot;</span>   <span class="p">,</span> <span class="s2">&quot;is_public&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;posts&quot;</span>   <span class="p">,</span> <span class="s2">&quot;position&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;posts&quot;</span>   <span class="p">,</span> <span class="s2">&quot;content&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;posts&quot;</span>   <span class="p">,</span> <span class="s2">&quot;poster_name&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;posts&quot;</span>   <span class="p">,</span> <span class="s2">&quot;post_title&quot;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>下指令</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">rake</span> <span class="n">db</span><span class="ss">:migrate</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>囧&#8230;..剛剛打錯字，現在要怎麼辦？！</p>

<p>因為我migrate的次數不多所以我使用的是</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">rake</span> <span class="n">db</span><span class="ss">:migrate</span> <span class="no">VERSION</span><span class="o">=</span><span class="mi">0</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>然後</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">rake</span> <span class="n">db</span><span class="ss">:migrate</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>歐耶～～</p>

<p>開始來手刻crud吧(Create/Read/Update/Destroy)</p>

<p> 論壇必須由主頁面導引過去，管理論壇必須要有一個controller</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> 
</span><span class='line'>  <span class="n">rails</span> <span class="n">g</span> <span class="n">controller</span> <span class="n">forums</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<pre><code>*別忘了加 resources :forums在config/routes.rb*
</code></pre>

<p>開始修改裡頭的檔案</p>

<p>因為需要ＣＲＵＤ所以要建立</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="c1"># show all forums</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># new a forum</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">new</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>       <span class="c1"># show this forum have what post</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># edit this forum&#39;s name , manager...etc </span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">edit</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>      <span class="c1"># kill this forum</span>
</span><span class='line'>      <span class="k">def</span> <span class="nf">destroy</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>因為要列出所有板名，所以要和資料庫要資料，因為rb檔都是一個class～那裡頭的資料呢？
所有的物件變數(@開頭)、類別變數(@@開頭)，都是封裝在類別內部的，類別外無法存取,
Forum是一個類別，繼承ActiveRecord這個類別就是專門操作資料庫的，
所以他有一個已經內建的方法譬如all就是列出全部資料，所以我們就使用這個，他回去得到是一個陣列</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="k">def</span> <span class="nf">index</span>
</span><span class='line'>      <span class="vi">@forums</span> <span class="o">=</span> <span class="no">Forum</span><span class="o">.</span><span class="n">all</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>再來如果要新增版名勒？當然就是要用繼承於ActiveRecord這個類別內建的方法new</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="k">def</span> <span class="nf">new</span>
</span><span class='line'>      <span class="vi">@forum</span> <span class="o">=</span> <span class="no">Forum</span><span class="o">.</span><span class="n">new</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>不過,既然要新增～那應該要有表格之類的東西～讓我輸入新增資料吧～</p>

<p>是低～沒錯～所以我們必須讓view出來啦！！！</p>

<p>到app/views/forums裡頭新增一個new.html.erb吧</p>

<p>不過&#8230;.這三小。 請參考<a href="http://ihower.tw/rails3/actionview.html">ihower的解釋</a></p>

<p>這時候你可以使用他們ror內建的程式碼區塊建立表單請看～～</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>        <span class="o">&lt;</span><span class="sx">%= form_for @forum, :url =</span><span class="o">&gt;</span> <span class="n">forums_path</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">     &lt;%= f.label :forum_name, &quot;版名&quot; %&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="sx">%= f.text_field :forum_name %&gt;</span>
</span><span class='line'><span class="sx">    </span>
</span><span class='line'><span class="sx"> &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">label</span> <span class="ss">:admin_forum_user</span><span class="p">,</span> <span class="s2">&quot; 管理者 &quot;</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">     &lt;%= f.text_field :admin_forum_user %&gt;</span>
</span><span class='line'>
</span><span class='line'>       <span class="o">&lt;</span><span class="sx">%= f.label :description, &quot;介紹&quot; %&gt;</span>
</span><span class='line'><span class="sx">     &lt;%=</span> <span class="n">f</span><span class="o">.</span><span class="n">text_area</span> <span class="ss">:description</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">    </span>
</span><span class='line'><span class="sx">     &lt;%= f.submit &quot;新增&quot; %&gt;</span>
</span><span class='line'>  <span class="o">&lt;</span><span class="sx">% end </span><span class="o">%&gt;</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>這時候你一定跟我一樣想罵Ｘ&#8230;</p>

<p>這又是啥！？</p>

<p>先問一個問題～你有沒有無聊看過網頁的程式碼～ 幹！沒錯～網頁就是這樣寫出來的～</p>

<p>請問你要一個一個慢慢打嗎？！ 如果是的話&#8230;你&#8230;.你&#8230;.瘋的厲害！</p>

<p>請看這段說明[節錄]自ihower (http://ihower.tw/rails3/basic.html)</p>

<p>這個form_for的程式碼區塊(Code block)被用來建立HTML表單。在區塊中，你可以使用各種函式來建構表單。例如f.text_field :name建立出一個文字輸入框，並填入@event的name屬性資料。但這個表單只能基於這個Model有的屬性(在這個例子是name跟description)。Rails偏好使用form_for而不是讓你手寫表單HTML，這是因為程式碼可以更加簡潔，而且可以明確地連結在Model物件上。
form_for區塊也很聰明，New event的表單跟Edit event的表單，其中的送出網址跟按鈕文字會不同的(根據@event的不同，前者是新建的，後者是已經建立過的)。
如果你需要建立任意欄位的HTML表單，而不綁在某一個Model上，你可以使用form_tag函式。它也提供了建構表單的函式而不需要綁在Model實例上。
所以我們要用這個函式就對了啦～他是ActionView::Helpers::FromHelper裡頭的一個method</p>

<p>至於，為甚麼:url => forums_path</p>

<p>請看http://ihower.tw/rails3/restful.html</p>

<p>url是form_for函數一個optinal的參數另外還有一個:html</p>

<p>看一下國外的說明：
The rightmost argument to form_for is an optional hash of options:</p>

<p>:url - The URL the form is submitted to. It takes the same fields you pass to url_for or link_to. In particular you may pass here a named route directly as well. Defaults to the current action.</p>

<p>:html - Optional HTML attributes for the form tag.</p>

<p>我個人的理解是你按下new這個動作時，你是需要到伺服器post 一個東西然後把他紀錄到資料庫裡頭，</p>

<p>對應到的是controller的create的動作，所以要使用forums_path，rail會自己判斷是index動作還是create動作。</p>

<p>當一個使用者點擊表單的Create按鈕時，瀏覽器就會送出資料到Controller的create Action</p>

<p>回到controller/forums吧～突然想到&#8230;.我們的index動作沒有搭配到view~~</p>

<p>所以我們來建立app/views/events/index.html.erb</p>

<p>在Rails會讓Action裡的實例變數(也就是有@開頭的變數)通通傳到View樣板裡面可以使用。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="o">&lt;</span><span class="n">ul</span><span class="o">&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="sx">% @forums.each </span><span class="k">do</span> <span class="o">|</span><span class="n">forum</span><span class="o">|</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">         &lt;li&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="sx">%= forum.forum_name %&gt;</span>
</span><span class='line'><span class="sx">         &lt;%=</span> <span class="n">forum</span><span class="o">.</span><span class="n">admin_forum_user</span><span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">         &lt;%= forum.description%&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="sx">%= forum.post_num%&gt;</span>
</span><span class='line'><span class="sx">         &lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;進入&#39;</span><span class="p">,</span> <span class="n">forum_path</span><span class="p">(</span><span class="n">forum</span><span class="p">)</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">         &lt;%= link_to &#39;編輯&#39;, edit_forum_path(forum) %&gt;</span>
</span><span class='line'>          <span class="o">&lt;</span><span class="sx">%= button_to &#39;刪除&#39;, forum_path(forum) , :method =</span><span class="o">&gt;</span> <span class="ss">:delete</span> <span class="sx">%&gt;</span>
</span><span class='line'><span class="sx">         &lt;/li&gt;</span>
</span><span class='line'>      <span class="o">&lt;</span><span class="sx">% end %&gt;</span>
</span><span class='line'><span class="sx"> &lt;/ul&gt;</span>
</span><span class='line'>  <span class="o">&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;新增論壇分類&#39;</span><span class="p">,</span> <span class="n">new_forum_path</span> <span class="o">%&gt;</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>參考自ihower - <a href="http://ihower.tw/rails3/restful.html">Restful</a>
注意到刪除的地方，我們多一個參數:method => :delete。非GET的操作，顧及網頁親和力可以把link_to改成用button_to。</p>

<p>link_to如果瀏覽器的JavaScript沒開，就會無法送出GET之外的操作。button_to就無此困擾，因為Rails是產生form標籤夾帶_method參數。</p>

<p>建好了秀資料的view之後～我們在回到剛剛那個new表格～使用者按下 &lt;%= f.submit &#8220;新增&#8221; %> 之後 表格的url設定是導到動作create所以我們來編輯/app/controllers/forums</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="k">def</span> <span class="nf">create</span>
</span><span class='line'>            <span class="vi">@forum</span> <span class="o">=</span> <span class="no">Forum</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:forum</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>            <span class="vi">@forum</span><span class="o">.</span><span class="n">save</span>
</span><span class='line'>            <span class="n">redirect_to</span> <span class="n">forums_url</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>create Action會透過從表單傳進來的資料，也就是Rails提供的params參數(這是一個Hash)，來實例化一個新的@event物件。</p>

<p>成功儲存之後，便將使用者重導(redirect)至show Action顯示活動內容。那為甚麼要使用redirect_to forums_url 幹，這個跟forums_path有啥差別！！！！</p>

<p>這邊就可以參考ihower大提供的圖片</p>

<p>寫法如下阿～</p>

<p>[custom route]<em>event[s]</em><a href="event">path/url</a>, :method => GET | POST | PUT | DELETE</p>

<p><em>path結尾是相對網址，而</em>url結尾則會加上完整Domain網址。</p>

<p>如果user要在論壇點進去ＸＸＸ區看有哪些文章時，就要用到show這個動作，這邊很簡單，你只要做，那個:id我在想應該是你點那個連結時～就會有帶入一個參數讓Forum找到這筆資料</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="k">def</span> <span class="nf">show</span>
</span><span class='line'>              <span class="vi">@forum</span> <span class="o">=</span> <span class="no">Forum</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:id</span><span class="o">]</span><span class="p">)</span>
</span><span class='line'>      <span class="k">end</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>當然～你改了show的動作之後，就要有view與之對應是吧～ 不然找到的資料要怎麼給人家看？那就新增一個show.html.erb吧</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'>     <span class="o">&lt;</span><span class="sx">%= @forum.forum_name %&gt; </span>
</span><span class='line'><span class="sx">     &lt;p&gt;&lt;%=</span> <span class="n">link_to</span> <span class="s1">&#39;回到主論壇&#39;</span><span class="p">,</span> <span class="n">forums_path</span> <span class="sx">%&gt;&lt;/p&gt;</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>靠邀&#8230;.我進到ＸＸ區，我想要知道這區有哪些文章&#8230;.怎麼辦？</p>

<p>首先我們必須先回到資料庫的部份，forum資料庫會跟post資料庫有關，那有關是怎麼樣個有關法</p>

<p>Rails 的 ActiveRecord 實作了db的正規化設計， 原則有四種</p>

<pre><code>has_one

has_many  

belongs_to 

has_many :through
</code></pre>

<p>要怎麼用勒？我們知道forums有許多post對八～～</p>

<p>所以要在app/model/forum裡頭我要加一句</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">has_many</span> <span class="ss">:posts</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>而post（文章）必定屬於一個forum（文章分區）對八～～</p>

<p>所以要在app/model/post加一句</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">belongs_to</span> <span class="p">:</span> <span class="n">forum</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>加了上面有什麼意義～幹～意義是殺小 林爸只知道義氣</p>

<p>不好意思離題了&#8230;.</p>

<p>當然你必須要在資料表中，那就是透過primary key和foreign keys將資料表互相關連起來</p>

<p>所以～我要先加入</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">rails</span> <span class="n">g</span> <span class="n">migration</span> <span class="n">add_forum_id_to_post</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>再來編輯這個產生的rb檔（會在db/migrate)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="k">class</span> <span class="nc">AddForumIdToPost</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Migration</span>
</span><span class='line'>          <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">up</span>
</span><span class='line'>          <span class="n">add_column</span><span class="p">(</span><span class="s2">&quot;posts&quot;</span> <span class="p">,</span> <span class="s2">&quot;forum_id&quot;</span> <span class="p">,</span> <span class="ss">:integer</span> <span class="p">)</span>
</span><span class='line'>          <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>          <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">down</span>
</span><span class='line'>          <span class="n">remove_column</span><span class="p">(</span><span class="s2">&quot;posts&quot;</span> <span class="p">,</span> <span class="s2">&quot;forum_id&quot;</span><span class="p">)</span>
</span><span class='line'>          <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>


<p>key 完之後別忘了&#8230;..</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'> <span class="n">rake</span> <span class="n">db</span><span class="ss">:migrate</span>
</span><span class='line'>  
</span></code></pre></td></tr></table></div></figure>



</div>


<div class="meta">
	<div class="date">








  


<time datetime="2011-11-10T01:13:00+08:00" pubdate data-updated="true">Nov 10<span>th</span>, 2011</time></div>
	

<div class="tags">

	<a class='category' href='/blog/categories/ruby-on-rails/'>Ruby on Rails</a>

</div>


	
		<span class="comments"><a href="/blog/2011/11/10/my-learning-ror-project-day-1/#disqus_thread">Comments</a></span>
	
</div></article>

	<div class="share">
	<div class="addthis_toolbox addthis_default_style ">
	
	<a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
	
	
	<a class="addthis_button_tweet"></a>
	
	
	<a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
	
<!---	<a class="addthis_counter addthis_pill_style"></a> --->
	</div>
  <script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid="></script>
</div>



<section id="comment">
    <h2 class="title">Comments</h2>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
</section>
</div>
	<footer id="footer" class="inner">Copyright &copy; 2015

    Aloha

<br>
Powered by Octopress.
</footer>
	<script src="/javascripts/slash.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script> <!-- Delete or comment this line to disable Fancybox -->


<script type="text/javascript">
      var disqus_shortname = 'ccaloha';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://ccaloha.cc/blog/2011/11/10/my-learning-ror-project-day-1/';
        var disqus_url = 'http://ccaloha.cc/blog/2011/11/10/my-learning-ror-project-day-1/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



	<script type="text/javascript">
		var _gaq = _gaq || [];
		_gaq.push(['_setAccount', 'UA-29608372-1']);
		_gaq.push(['_trackPageview']);

		(function() {
			var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
			ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
		})();
	</script>


<a title="Google Analytics Alternative" href="http://clicky.com/100753071"><img alt="Google Analytics Alternative" src="//static.getclicky.com/media/links/badge.gif" border="0" /></a>
<script src="//static.getclicky.com/js" type="text/javascript"></script>
<script type="text/javascript">try{ clicky.init(100753071); }catch(e){}</script>
<noscript><p><img alt="Clicky" width="1" height="1" src="//in.getclicky.com/100753071ns.gif" /></p></noscript>

</body>
</html>
